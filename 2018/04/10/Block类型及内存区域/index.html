<!DOCTYPE html>
<html lang="z">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>Blockç±»å‹åŠå†…å­˜åŒºåŸŸ | æ¸©å‡‰</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="å–œæ¬¢OCï¼Œç›®å‰æ˜¯ä¸€åiOSç¼–ç¨‹äººå‘˜ï¼›åœ¨Pythonè¿›ä¿®çš„è·¯ä¸Š">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Blockç±»å‹åŠå†…å­˜åŒºåŸŸ | æ¸©å‡‰">
    <meta name="twitter:description" content="å–œæ¬¢OCï¼Œç›®å‰æ˜¯ä¸€åiOSç¼–ç¨‹äººå‘˜ï¼›åœ¨Pythonè¿›ä¿®çš„è·¯ä¸Š">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Blockç±»å‹åŠå†…å­˜åŒºåŸŸ | æ¸©å‡‰">
    <meta property="og:description" content="å–œæ¬¢OCï¼Œç›®å‰æ˜¯ä¸€åiOSç¼–ç¨‹äººå‘˜ï¼›åœ¨Pythonè¿›ä¿®çš„è·¯ä¸Š">

    
    <meta name="author" content="æ¸©å‡‰">
    
    <link rel="stylesheet" href="../../../../css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/avatar-small.png">
    

    <meta name="generator" content="hexo"/>
    

    <link rel="canonical" href="http://lanjiying.allenqin.com/2018/04/10/Blockç±»å‹åŠå†…å­˜åŒºåŸŸ/"/>

                 
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="../../../../js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="å‰å¾€ æ¸©å‡‰ çš„ä¸»é¡µ"><img src="/images/avatar.jpg" width="80" alt="æ¸©å‡‰ logo" class="panel-cover__logo logo"></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for æ¸©å‡‰">æ¸©å‡‰</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">ä¸å¿µè¿‡å¾€ã€ä¸è´Ÿå½“ä¸‹ã€ä¸ç•å°†æ¥</span>
        
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">å–œæ¬¢OCï¼Œç›®å‰æ˜¯ä¸€åiOSç¼–ç¨‹äººå‘˜ï¼›åœ¨Pythonè¿›ä¿®çš„è·¯ä¸Š</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="Visit the blog" class="blog-button">æ¸©å‡‰çš„å°é•‡</a></li>
            
              <li class="navigation__item"><a href="/aboutMe">å…³äºæˆ‘</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  
  <li class="navigation__item">
    <a href="https://weibo.com/u/2683037683" title="Weibo" target="_blank">
      <i class="social fa fa-weibo"></i>
      <span class="label">Weibo</span>
    </a>
  </li> 


  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/onlyAngelia" title="GitHub" target="_blank">
      <i class="social fa fa-github"></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-purple"></div>
  </div> 
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2018-04-10T14:55:08.000Z" class="post-list__meta--date date">2018-04-10</time> &#8226; <span class="post-meta__tags tags">äº 
  <a class="tag-link" href="../../../../tags/Objective-C-Block/">Objective-C/Block</a>
 </span>
      <span class="page-pv">
       Read <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">Blockç±»å‹åŠå†…å­˜åŒºåŸŸ</h1>
  </header>

  <section class="post">
    <p>åœ¨<a href="https://onlyangelia.github.io/2018/04/06/Blockå‰è¨€/" target="_blank" rel="noopener">Blockå‰è¨€</a>ä¸­ï¼Œè®²åˆ°Block çš„isaæŒ‡é’ˆå…­ç§ç±»å‹ï¼Œä»¥åŠæ¯ç§ç±»å‹çš„å­˜å‚¨åŒºåŸŸã€‚ç®€å•å›é¡¾ä¸€ä¸‹æœ€ç»ˆç»“è®º</p>
<table><br>  <tr><br>    <th width="35%," bgcolor="#eeeeee">ç±»å‹</th><br>    <th width="35%," bgcolor="#eeeeee">æŸ¥çœ‹æº</th><br>    <th width="30%," bgcolor="#eeeeee">å­˜å‚¨åŒºåŸŸ</th><br>  </tr><br> <tr><br>    <td>_NSConcreteGlobalBlock</td><br>    <td> .cppæ–‡ä»¶/Block.h </td><br>    <td> å…¨å±€å˜é‡/é™æ€å˜é‡åŒº</td><br>  </tr><br>  <tr><br>    <td>_NSConcreteStackBlock </td><br>    <td> .cppæ–‡ä»¶/Block.h</td><br>    <td> æ ˆåŒº </td><br>  </tr><br> <tr><br>    <td>_NSConcreteMallocBlock </td><br>    <td> Block_private.hæ–‡ä»¶</td><br>    <td> å †åŒº</td><br>  </tr><br><tr><br>    <td>_NSConcreteAutoBlock </td><br>    <td> Block_private.hæ–‡ä»¶</td><br>    <td> å †åŒº</td><br>  </tr><br><tr><br>    <td>_NSConcreteFinalizingBlock </td><br>    <td> Block_private.hæ–‡ä»¶</td><br>    <td> å †åŒº</td><br>  </tr><br><tr><br>    <td>_NSConcreteWeakBlockVariable </td><br>    <td> Block_private.hæ–‡ä»¶</td><br>    <td> å †åŒº</td><br>  </tr><br></table>


<p>ä»¥ä¸Šå†…å®¹çš„æŸ¥çœ‹åœ¨ç¼–è¯‘åçš„cppæ–‡ä»¶ä»¥åŠruntimeæºç ä¸­éƒ½å¯ä»¥æŸ¥çœ‹åˆ°ç›¸å…³ä¿¡æ¯<br><a href="https://github.com/onlyAngelia/YAObjectTest.git" target="_blank" rel="noopener">codeå·²ä¸Šä¼ åˆ°Github,ç‚¹å‡»ä¸‹è½½</a><br><a href="https://opensource.apple.com/source/objc4/objc4-680/runtime/" target="_blank" rel="noopener">runtimeæºç Appleå®˜ç½‘</a><br><a href="https://github.com/onlyAngelia/objc-runtime" target="_blank" rel="noopener">runtimeæºç Github</a></p>
<h1 id="ç‰¹åˆ«æ³¨æ„ç‚¹"><a href="#ç‰¹åˆ«æ³¨æ„ç‚¹" class="headerlink" title="ç‰¹åˆ«æ³¨æ„ç‚¹"></a>ç‰¹åˆ«æ³¨æ„ç‚¹</h1><p>Blockå‰è¨€ä¸­è®²åˆ°é»˜è®¤åˆ›å»ºçš„BlockæŒ‡é’ˆåªæœ‰Globalã€Statckï¼Œå…¶å®ƒå››ç§æ˜¯åœ¨è¿è¡Œæ—¶ç¼–è¯‘ç¯å¢ƒå†³å®šçš„ï¼Œæ­¤æ ¹æ®ä¹Ÿæ˜¯æ ¹æ®runtimeæºç å’Œæ³¨é‡Šå¾—å‡ºç»“è®ºã€‚</p>
<pre><code class="cpp">// the raw data space for runtime classes for blocks
// class+meta used for stack, malloc, and collectable based blocks
BLOCK_EXPORT void * _NSConcreteMallocBlock[32]
    __OSX_AVAILABLE_STARTING(__MAC_10_6, __IPHONE_3_2);
BLOCK_EXPORT void * _NSConcreteAutoBlock[32]
    __OSX_AVAILABLE_STARTING(__MAC_10_6, __IPHONE_3_2);
BLOCK_EXPORT void * _NSConcreteFinalizingBlock[32]
    __OSX_AVAILABLE_STARTING(__MAC_10_6, __IPHONE_3_2);
BLOCK_EXPORT void * _NSConcreteWeakBlockVariable[32]
    __OSX_AVAILABLE_STARTING(__MAC_10_6, __IPHONE_3_2);
</code></pre>
<p>ä»ä»¥ä¸Šruntimeæºç å’Œæ³¨é‡Šä¸­æˆ‘ä»¬å¯ä»¥å¾ˆå¥½çš„è§£é‡Šè¯¥6ç§Blockåœ¨Macå’ŒiOSç³»ç»Ÿä¸­éƒ½ä¼šå‡ºç°ï¼Œé™¤Globalã€Statckï¼Œå…¶å®ƒå››ç§æ˜¯åœ¨è¿è¡Œæ—¶ç¼–è¯‘ç¯å¢ƒå†³å®šã€‚</p>
<h1 id="æ¯ç§Blockå‡ºç°çš„æƒ…å†µ"><a href="#æ¯ç§Blockå‡ºç°çš„æƒ…å†µ" class="headerlink" title="æ¯ç§Blockå‡ºç°çš„æƒ…å†µ"></a>æ¯ç§Blockå‡ºç°çš„æƒ…å†µ</h1><p>ï¼ˆæœ€å¥½å¤ä¹ ä¸€ä¸‹åŸºæœ¬æ•°æ®ç»“æ„ï¼‰</p>
<h2 id="NSConcreteGlobalBlock"><a href="#NSConcreteGlobalBlock" class="headerlink" title="_NSConcreteGlobalBlock"></a>_NSConcreteGlobalBlock</h2><p>åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼ŒBlockä¸ºGlobalBlock (æ ¹æ®èµ‹å€¼æƒ…å†µä¼šå†³å®šå­˜å‚¨é™æ€åŒºçš„é™æ€å˜é‡åŒºåŸŸè¿˜æ˜¯å…¨å±€å˜é‡åŒºåŸŸ)<br><strong>1.Blockå£°æ˜ä¸ºå…¨å±€å˜é‡<br>2.å‡½æ•°åŒºåŸŸå†…Blockè¯­æ³•è¡¨è¾¾å¼æ²¡æœ‰ä½¿ç”¨å¤–éƒ¨å˜é‡<br>3.Blockå†…éƒ¨åªå¼•ç”¨äº†å†…éƒ¨ä¼ é€’å€¼æˆ–åªå¼•ç”¨äº†é™æ€å˜é‡æˆ–å…¨å±€å˜é‡</strong></p>
<p>ç¬¬ä¸€ç§æƒ…å†µå¥½ç†è§£,ä¸€èˆ¬æˆ‘ä»¬å£°æ˜çš„å…¨å±€å˜é‡éƒ½ä¼šæ”¾åœ¨é™æ€åŒº,å½“Blockè¢«å£°æ˜ä¸ºå…¨å±€å˜é‡æ—¶ä¹Ÿä¼šå­˜æ”¾åœ¨é™æ€åŒºåŸŸ<br>å¦‚ä¸‹å°†Blockå£°æ˜ä¸ºå…¨å±€å˜é‡,æŸ¥çœ‹ç¼–è¯‘åçš„cppæ–‡ä»¶,æ‰¾åˆ°å¯¹åº”çš„ç¼–è¯‘ä»£ç <br>æºç :</p>
<pre><code>#import &quot;BlockObject.h&quot;
#import &lt;objc/runtime.h&gt;

void (^globalBlock)(void)=^{};

@interface BlockObject()
</code></pre><p>ç¼–è¯‘åçš„éƒ¨åˆ†ä»£ç :</p>
<pre><code>struct __globalBlock_block_impl_0 {
  struct __block_impl impl;
  struct __globalBlock_block_desc_0* Desc;
  __globalBlock_block_impl_0(void *fp, struct __globalBlock_block_desc_0 *desc, int flags=0) {
    impl.isa = &amp;_NSConcreteGlobalBlock;
    impl.Flags = flags;
    impl.FuncPtr = fp;
    Desc = desc;
  }
};
</code></pre><p>`impl.isa = &amp;_NSConcreteGlobalBlock;å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å£°æ˜çš„<strong>å…¨å±€å˜é‡blockä¸ºNSConcreteGlobalBlock</strong>ã€‚</p>
<p>ç¬¬äºŒç§æƒ…å†µæˆ‘ä»¬å¯ä»¥çœ‹å¦‚ä¸‹ä»£ç </p>
<pre><code> typedef int (^blockStatic)(void);
blockStatic secondBlk = ^(){
        return 1;
 };
NSLog(@&quot;%@&quot;,secondBlk);
</code></pre><p>æœ€åæŸ¥çœ‹åˆ°è¾“å‡ºç»“æœå¦‚ä¸‹</p>
<pre><code>YAObjectTest[8834:1196308]
 &lt;__NSGlobalBlock__: 0x10de381c8&gt;
</code></pre><p>æ‰€ä»¥ï¼Œ<strong>æœªå¼•ç”¨å¤–éƒ¨å˜é‡æ—¶ï¼Œæœ€ç»ˆå¾—åˆ°çš„blockä¹Ÿæ˜¯NSConcreteGlobalBlock</strong>ã€‚</p>
<p>ç¬¬ä¸‰ç§æƒ…å†µæˆ‘çœ‹å¯ä»¥çœ‹å¦‚ä¸‹ä»£ç </p>
<pre><code>static int count = 100;
typedef int (^blockStatic)(void);
blockStatic blk = ^(){
        return count;
    };
     NSLog(@&quot;%@&quot;,blk);
</code></pre><p>æœ€åçš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>YAObjectTest[8719:1185296]
 &lt;__NSGlobalBlock__: 0x108320188&gt;
</code></pre><p>æœ€åçš„è¾“å‡ºä¹Ÿæ˜¯GlobalBlockï¼Œæ‰€ä»¥ï¼Œ<strong>åªå¼•ç”¨é™æ€å˜é‡æˆ–å…¨å±€å˜é‡æ—¶ï¼ŒBlockä»ä¸ºNSConcreteGlobalBlock</strong>ã€‚</p>
<hr>
<p>è§£æƒ‘ï¼šç¬¬äºŒç§æƒ…å†µå’Œç¬¬ä¸‰ç§æƒ…å†µæˆ‘ä»¬æœ€ç»ˆæŸ¥çœ‹çš„æ˜¯è¾“å‡ºæƒ…å†µï¼Œè€Œä¸æ˜¯clangåçš„æºæ–‡ä»¶ã€‚æŸ¥çœ‹clangåçš„æºæ–‡ä»¶è¯¥ä¸¤ç§æƒ…å†µå¾—åˆ°çš„æ˜¯StackBlockã€‚ç¼–è¯‘å™¨æ ¹æ®ç¼–è¯‘ç‰¹æ€§ä¼šæŠŠåä¸¤ç§æƒ…å†µé»˜è®¤ç¼–è¯‘åå®šä¹‰ä¸ºStackBlockï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“OCæ˜¯åŠ¨æ€è¯­è¨€ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯ä»¥è¿è¡Œæ—¶æˆ–æœ€ç»ˆè¾“å‡ºç»“æœä¸ºå‡†ã€‚</p>
<hr>
<h1 id="NSConcreteStackBlock"><a href="#NSConcreteStackBlock" class="headerlink" title="_NSConcreteStackBlock"></a>_NSConcreteStackBlock</h1><p><strong>1.ä½¿ç”¨åˆ°å¤–éƒ¨å±€éƒ¨å˜é‡ã€æˆå‘˜å±æ€§å˜é‡ï¼ˆéé™æ€å˜é‡å€¼ï¼‰&amp; 2.æœªä½¿ç”¨strongæˆ–copyä¿®é¥°ç¬¦ä¿®é¥°</strong><br><strong>ä»¥ä¸Šæ¡ä»¶ç¼ºä¸€ä¸å¯ï¼Œåªæœ‰è¿™ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æˆç«‹æ—¶ï¼ŒBlockæ‰ä¸º_NSConcreteStackBlock</strong><br>å¦‚æœåœ¨å‡½æ•°å†…ï¼ŒBlockåªæ˜¯å¼•ç”¨äº†å¤–éƒ¨å±€éƒ¨å˜é‡æˆ–æˆå‘˜å±æ€§å˜é‡ï¼Œæœ€ç»ˆä¼šè¢«copyåˆ°å †ä¸Šå˜ä¸ºMallocBlockã€‚è€Œå¯¹äºå£°æ˜ä¸ºå±æ€§çš„Blockï¼Œå¦‚æœä¿®é¥°ç¬¦ä¸ºstrongæˆ–copyï¼Œåˆ™ä¹Ÿä¼šcopyåˆ°å †ä¸Šï¼Œè€Œä¸æ˜¯StackBlockã€‚<br>æŸ¥çœ‹ä»¥ä¸‹ä»£ç çš„æœ€ç»ˆè¾“å‡ºï¼ˆä¸èƒ½åŒæ—¶æ»¡è¶³ä¸Šè¿°ä¸¤ç§æ¡ä»¶çš„æƒ…å†µä¸‹ï¼‰</p>
<pre><code>@interface BlockObject()

@property (nonatomic, strong)void(^proBlock)(void);
@property (nonatomic, assign)NSInteger outsideCount;

@end

     int a = 1;
    //ä½¿ç”¨å¤–éƒ¨å±€éƒ¨å˜é‡æƒ…å†µ
    void (^blockVariable)(void) = ^(){
        NSLog(@&quot;%ld&quot;,(long)_outsideCount);
    };
    NSLog(@&quot;%@&quot;,blockVariable);

    _proBlock = ^(){
        NSLog(@&quot;%d&quot;,a);
    };
    NSLog(@&quot;%@&quot;,_proBlock);
</code></pre><p>æœ€ç»ˆæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹</p>
<pre><code> &lt;__NSMallocBlock__: 0x600000447c50&gt;
 &lt;__NSMallocBlock__: 0x6040002557b0&gt;

</code></pre><p>å°†proBlockçš„ä¿®é¥°ç¬¦æ¢æˆweakï¼Œ</p>
<pre><code>@property (nonatomic, weak)void(^proBlock)(void);
</code></pre><p>åŒæ ·çš„ä»£ç ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹ç»“æœï¼ŒproBlockä¼šæ˜¯StackBlock</p>
<pre><code>YAObjectTest[10461:1384618] &lt;__NSMallocBlock__: 0x60400025d1f0&gt;
YAObjectTest[10461:1384618] &lt;__NSStackBlock__: 0x7ffee9f07930&gt;
</code></pre><p>æ‰€ä»¥ï¼Œ<strong>åœ¨å¼•ç”¨äº†å¤–éƒ¨å˜é‡å¹¶ä¸”æ²¡æœ‰å¼ºæŒ‡é’ˆå¼•ç”¨çš„æƒ…å†µä¸‹çš„Blockä¸º_NSConcreteStackBlock</strong>ã€‚</p>
<h1 id="NSConcreteMallocBlock"><a href="#NSConcreteMallocBlock" class="headerlink" title="_NSConcreteMallocBlock"></a>_NSConcreteMallocBlock</h1><p>1.å¼•ç”¨äº†å¤–éƒ¨å˜é‡ï¼Œæœ‰strongæˆ–copyä¿®é¥°ç¬¦ä¿®é¥°<br>2.blockå†…éƒ¨éœ€è¦ä¿®æ”¹å¼•ç”¨å˜é‡çš„å€¼ï¼Œå¤–éƒ¨å˜é‡è¢«<strong>blockä¿®é¥°<br>ç¬¬ä¸€ç§æƒ…å†µåœ¨æ±‚è¯StackBlockçš„æƒ…å†µä¸‹å·²ç»å¾—åˆ°éªŒè¯ï¼Œæœ‰strongæˆ–copyä¿®é¥°åå¹¶ä¸”å¼•ç”¨äº†å¤–éƒ¨å˜é‡çš„æƒ…å†µä¸‹ï¼Œä¸º** &lt;</strong>NSMallocBlock__: 0x6040002557b0&gt;**<br>æœ‰å…³ç¬¬äºŒç§æƒ…å†µï¼Œåœ¨è¯¥æ–‡åªåšéªŒè¯ï¼Œåç»­æ·±å…¥è§£æï¼Œè¯¦è§Blockæˆªè·å˜é‡ä¸­çš„__blockä¿®é¥°ç¬¦æ·±å…¥è§£æ</p>
<pre><code>    __block int a = 0;
    void (^lockBlock)(void) = ^{
        a++;
    };
    lockBlock();
    NSLog(@&quot;%@&quot;, lockBlock);
</code></pre><p>æœ€åçš„è¾“å‡ºç»“æœä¸º</p>
<pre><code>YAObjectTest[10853:1425358] &lt;__NSMallocBlock__: 0x60000024e610&gt;
</code></pre><p>åœ¨æ­¤å°±æ±‚è¯äº†ä»¥ä¸Šä¸¤ç§ç»“æœæœ€åBlockä¸º_NSConcreteMallocBlockã€‚</p>
<hr>
<p>æ¥ä¸‹æ¥çš„ä¸‰ç§ç±»å‹Blockï¼Œå› å¯¹æœ‰GCå›æ”¶æœºåˆ¶çš„è¯­è¨€ä¸æ˜¯å¤ªç†Ÿæ‚‰ï¼Œåœ¨Xcodeä¸­ç¼–å†™çš„C++ä»£ç  æœ€ç»ˆæŸ¥çœ‹è¿è¡Œæ—¶çš„isaæŒ‡é’ˆçš†ä¸ºâ€”NSStackBlockï¼Œåœ¨Xcodeä¸­å¹¶æ²¡æœ‰æŒ‰ç…§é¢„æƒ³çš„æŸ¥çœ‹åˆ°ä»¥ä¸‹ä¸‰ç§ç±»å‹ï¼ŒTerminalç»ˆç«¯g++ ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶ä¹Ÿæœªè§ä»¥ä¸‹ç±»å‹ï¼ŒæŸ¥é˜…èµ„æ–™å‘ç°ä»¥ä¸‹ä¸‰ç§å‡ºç°çš„æƒ…å†µå¤§è‡´å¦‚ä¸‹ï¼Œè‹¥æœ‰å¯¹C++ ç†Ÿæ‚‰çš„äººå‘˜ ï¼Œè¯·ä¸åèµæ•™ğŸ˜‰</p>
<hr>
<h1 id="NSConcreteFinalizingBlock"><a href="#NSConcreteFinalizingBlock" class="headerlink" title="_NSConcreteFinalizingBlock"></a>_NSConcreteFinalizingBlock</h1><p>.Blockéœ€è¦copyåˆ°å †ä¸Šï¼Œä½†æ˜¯Blockå†…éƒ¨æœ‰ctors å’Œ dtorsæ—¶ï¼Œblockä¼šæ˜¯NSFinalizingBlock</p>
<h1 id="NSConcreteAutoBlock"><a href="#NSConcreteAutoBlock" class="headerlink" title="_NSConcreteAutoBlock"></a>_NSConcreteAutoBlock</h1><p>.Blockéœ€è¦copyåˆ°å †ä¸Šè‹¥æœªå¼•ç”¨åˆ°ctorså’Œ dtors åˆ™æ˜¯NSAutoBlock<br>ä»¥ä¸Šæ˜¯AutoBlockå’ŒFinalizingBlockçš„å‡ºç°æƒ…å†µã€‚è€Œå¯¹äºctorså’Œdtorsï¼Œ<br>ctorsä¸­ä¿å­˜ç€ç¨‹åºå…¨éƒ¨æ„é€ å‡½æ•°çš„æŒ‡é’ˆæ•°ç»„ï¼Œdtorsä¸­ä¿å­˜ç€ç¨‹åºå…¨éƒ¨ææ„å‡½æ•°çš„æŒ‡é’ˆæ•°ç»„ï¼Œä»ä¸¤è€…çš„å­˜å‚¨å†…å®¹æ¥çœ‹ï¼Œè‹¥blockå¼•ç”¨äº†è¯¥ä¸¤ç§ç±»å‹ï¼ŒåŠ¿å¿…blockä¼šåœ¨ç¨‹åºè¿è¡Œç»“æŸæ—¶å›æ”¶å†…å­˜ï¼Œæ‰€ä»¥ä¼šè¢«è½¬æ¢ä¸ºFinalizingBlockï¼Œè€Œæœªå¼•ç”¨çš„blockåˆ™ä¼šæ ¹æ®æƒ…å†µè‡ªåŠ¨å›æ”¶ï¼Œè½¬æ¢ä¸ºAutoBlockã€‚</p>
<p>ä»¥ä¸‹æ˜¯å†™åœ¨cppæ–‡ä»¶ä¸­çš„ä»£ç </p>
<pre><code>void testAutoBlock(){
  int * b=new int[4];
   __block int testCount = 100;
   int (^myBlock)() = ^() {
        b[0] = testCount;
        b[1] = testCount + 1;
        b[2] = testCount + 2;
        b[3] = testCount + 3;
        std::cout&lt;&lt;b&lt;&lt;std::endl;
       return 0;
    };
    std::cout&lt;&lt;myBlock&lt;&lt;std::endl;
   }ï¼›
</code></pre><h1 id="NSConcreteWeakBlockVariable"><a href="#NSConcreteWeakBlockVariable" class="headerlink" title="_NSConcreteWeakBlockVariable"></a>_NSConcreteWeakBlockVariable</h1><p>.GCå›æ”¶æœºåˆ¶ä¸‹ï¼Œç”¨_weak æˆ–<strong>blockä¿®é¥°çš„block ä¼šè½¬å˜æˆNSWeakBlockVariable<br>å…·ä½“çš„å¯¹äº</strong>weak å’Œ__blcokä¿®é¥°ç¬¦ï¼Œåœ¨åé¢æˆªè·å˜é‡å’Œå¾ªç¯å¼•ç”¨ä¸­å…·ä½“è¯¦è§£ã€‚<br>ä»¥ä¸Šæ˜¯ä¸ªäººå¯¹äºBlockç±»å‹å’Œå­˜å‚¨åŒºåŸŸçš„æ€»ç»“ã€‚ä¸­é—´ä¸ºæ¢ç©¶åä¸‰ç§ç±»å‹æµªè´¹äº†å¾ˆå¤šæ—¶é—´ï¼Œå¯¼è‡´æ–‡ç« å»¶è¿Ÿã€‚</p>

  </section>

</article>

<section class="read-more">
           
    
               
            <div class="read-more-item">
                <span class="read-more-item-dim">Newer Post</span>
                <h2 class="post-list__post-title post-title"><a href="/2018/05/07/Blockè‡ªåŠ¨æˆªè·å˜é‡/" title="Blockè‡ªåŠ¨æˆªè·å˜é‡">Blockè‡ªåŠ¨æˆªè·å˜é‡</a></h2>
                <p class="excerpt">
                
                ã€ŠBlockå‰è¨€ã€‹ä¸­è®²åˆ°ï¼Œä¸è®ºä½•ç§ç±»å‹çš„Blockéƒ½è‡ªå¸¦æˆªè·å˜é‡è¿™ä¸€æŠ€èƒ½ï¼Œè€Œé’ˆå¯¹ä¸åŒçš„å˜é‡ç±»å‹å’Œä¸åŒçš„æƒ…å†µï¼Œè‡ªåŠ¨æˆªè·åˆ†ä¸ºä»¥ä¸‹æƒ…å†µ
1.æˆªè·å˜é‡çš„å€¼2.æˆªè·å¯¹è±¡,å°†å¯¹è±¡æŒ‡é’ˆä¼ é€’è¿›å»3.å°†å˜é‡æ‹·è´åˆ°å †åŒºåŸŸï¼Œå¹¶æŒæœ‰å˜é‡4.æˆªè·å˜é‡å†…å­˜åœ°å€
ç°é’ˆå¯¹ä»¥ä¸Šå†…å®¹è¿›è¡Œè¯¦ç»†åˆ†æã€‚
æˆªè·å˜é‡çš„å€¼è¿™ä¸€æƒ…å†µä¸»è¦å‘ç”Ÿåœ¨1.å¯¹
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2018-05-07T14:55:08.000Z" class="post-list__meta--date date">2018-05-07</time> &#8226; <span class="post-list__meta--tags tags">äº 
  <a class="tag-link" href="../../../../tags/Objective-C-Block/">Objective-C/Block</a>
</span><a class="btn-border-small" href="/2018/05/07/Blockè‡ªåŠ¨æˆªè·å˜é‡/">é˜…è¯»æ›´å¤š</a></div>
                           
            </div>
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">Older Post</span>
                <h2 class="post-list__post-title post-title"><a href="/2018/04/09/Blockå®è´¨/" title="Blockå®è´¨">Blockå®è´¨</a></h2>
                <p class="excerpt">
                
                ã€ŠBlockå‰è¨€ã€‹ä¸­è®²åˆ°ï¼ŒBlockæ˜¯å¯¹Cè¯­è¨€çš„æ‰©å……ï¼ŒBlockä¸ºå¸¦æœ‰è‡ªåŠ¨å˜é‡ï¼ˆå±€éƒ¨å˜é‡ï¼‰çš„åŒ¿åå‡½æ•°ã€‚æŸ¥çœ‹æºç å¾—çŸ¥OCä¸­ï¼ŒBlockæ˜¯ä½œä¸ºå¯¹è±¡å­˜åœ¨ã€‚è¯¥ç¯‡æ–‡ç« é’ˆå¯¹è¿™ä¸¤ç‚¹å±•å¼€ç»†èŠ‚ã€‚
#Blockä¸ºå¸¦æœ‰è‡ªåŠ¨å˜é‡ï¼ˆå±€éƒ¨å˜é‡ï¼‰çš„åŒ¿åå‡½æ•°æ¥ä¸‹æ¥ï¼Œæ ¹æ®clangå‘½ä»¤clang -rewrite-objc Bloc
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2018-04-09T14:55:08.000Z" class="post-list__meta--date date">2018-04-09</time> &#8226; <span class="post-list__meta--tags tags">äº 
  <a class="tag-link" href="../../../../tags/Objective-C-Block/">Objective-C/Block</a>
</span><a class="btn-border-small" href="/2018/04/09/Blockå®è´¨/">é˜…è¯»æ›´å¤š</a></div>
                       
            </div>
        
     
   
   
  
</section>

  

            <footer class="footer">
    <span class="footer__copyright">
        &copy; 2019 æ¸©å‡‰ - æœ¬ç«™ç‚¹é‡‡ç”¨ <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a>
       
    </span>
    <span class="footer__copyright">
             - åŸºäº <a href="http://hexo.io">Hexo</a> æ­å»ºï¼Œä½¿ç”¨ <a href="https://github.com/monniya/hexo-theme-new-vno ">new-vno</a> ä¸»é¢˜ï¼Œç”±<a href="https://monniya.com ">@Monniya</a> ä¿®æ”¹è‡ª <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, åŸåˆ›å‡ºè‡ª<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
         </span>
       
    
  
         <script type="text/x-mathjax-config">
    MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
        tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
        TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
        messageStyle: "none"
    }); 
    
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
   
</footer>


        </div>
    </div>

     
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-78918255-1', 'auto');
	ga('send', 'pageview');
</script>

    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?9cdad07c755fa23f6aced510c6760e87";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
</body>
</html>
